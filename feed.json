{
    "version": "https://jsonfeed.org/version/1",
    "title": "(人 •͈ᴗ•͈) ♡♡",
    "subtitle": "不用担心，这次肯定不会有问题",
    "icon": "https://sunforritual.github.io/yangxs.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://sunforritual.github.io/yangxs.github.io",
    "items": [
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/04/JS%E9%80%86%E5%90%91/%E5%B8%B8%E7%94%A8hook/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/04/JS%E9%80%86%E5%90%91/%E5%B8%B8%E7%94%A8hook/",
            "title": "常用hook",
            "date_published": "2024-03-04T03:25:28.146Z",
            "content_html": "<h4 id=\"1-json-hook\"><a class=\"anchor\" href=\"#1-json-hook\">#</a> 1 JSON HOOK</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> my_stringify <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>stringify<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">stringify</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">debugger</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_stringify params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> my_parse <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">parse</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">debugger</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_parse params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_parse</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"2-请求hook-当请求url里包含anlysis时插入断点\"><a class=\"anchor\" href=\"#2-请求hook-当请求url里包含anlysis时插入断点\">#</a> 2 请求 hook 当请求 url 里包含 anlysis 时，插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">var</span> open <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>open<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">open</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"analysis\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">open</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"3-过debugger1-constructor-构造器构造出来的\"><a class=\"anchor\" href=\"#3-过debugger1-constructor-构造器构造出来的\">#</a> 3 过 debugger—1 constructor 构造器构造出来的</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> _constructor <span class=\"token operator\">=</span> constructor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">constructor</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_constructor</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"4-headers-hook-当header中包含authorization时则插入断点\"><a class=\"anchor\" href=\"#4-headers-hook-当header中包含authorization时则插入断点\">#</a> 4 headers hook 当 header 中包含 Authorization 时，则插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">code</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> org <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>setRequestHeader<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setRequestHeader</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span>value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">==</span><span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">org</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>script<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> code <span class=\"token operator\">+</span> <span class=\"token string\">')()'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>head<span class=\"token operator\">||</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>script<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"5-请求hook-当请求的url里包含mmewmd时则插入断点\"><a class=\"anchor\" href=\"#5-请求hook-当请求的url里包含mmewmd时则插入断点\">#</a> 5 请求 hook 当请求的 url 里包含 MmEwMD 时，则插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">code</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> open <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>open<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">open</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MmEwMD\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">open</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>script<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> code <span class=\"token operator\">+</span> <span class=\"token string\">')()'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>head<span class=\"token operator\">||</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>script<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"6-过debugger2-eval的\"><a class=\"anchor\" href=\"#6-过debugger2-eval的\">#</a> 6 过 debugger—2 eval 的</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">var</span> eval_ <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">eval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">eval_</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"debugger;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"  ; \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">.</span>toString <span class=\"token operator\">=</span> eval_<span class=\"token punctuation\">.</span>toString<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"7-对象属性hook-属性自定义hook-cookie操作\"><a class=\"anchor\" href=\"#7-对象属性hook-属性自定义hook-cookie操作\">#</a> 7 对象属性 hook 属性自定义，hook cookie 操作</h4>\n<p>这种操作只是针对通过 js 生成的 cookie，若 cookie 是服务器后台返回的则不起效果</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 严格模式，检查所有错误</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">'use strict'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//document 为要 hook 的对象，属性是 cookie</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span><span class=\"token string\">'cookie'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">//hook set 方法也就是赋值的方法，get 就是获取的方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function-variable function\">set</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// 这样就可以快速给下面这个代码行下断点，从而快速定位设置 cookie 的代码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 在此处自动断下</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hook捕获到set-cookie ->'</span><span class=\"token punctuation\">,</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> val<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"8-evalfunction\"><a class=\"anchor\" href=\"#8-evalfunction\">#</a> 8 eval/Function</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>window<span class=\"token punctuation\">.</span>__cr_eval <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">myeval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//src 就是 eval 运行后 最终返回的值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"========= eval end ===========\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span>__cr_eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> _myeval <span class=\"token operator\">=</span> <span class=\"token function\">myeval</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>_myeval<span class=\"token punctuation\">.</span>toString <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>__cr_eval<span class=\"token punctuation\">.</span>toString<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">'eval'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> _myeval<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>window<span class=\"token punctuation\">.</span>_cr_fun <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>Function</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">myfun</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">var</span> args <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> src <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">[</span>arguments<span class=\"token punctuation\">.</span>lenght <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"======== Function end =============\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">_cr_fun</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>myfun<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span>_cr_fun <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">// 小花招，这里防止代码里检测原生函数</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Function\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> myfun<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"9-eval-取返回值\"><a class=\"anchor\" href=\"#9-eval-取返回值\">#</a> 9 eval 取返回值</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>_eval <span class=\"token operator\">=</span> eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function-variable function\">eval</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    res1 <span class=\"token operator\">=</span> res <span class=\"token comment\">// 返回值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_eval</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>xxxxxxxxx<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"10-websocket-hook\"><a class=\"anchor\" href=\"#10-websocket-hook\">#</a> 10 websocket hook</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1、webcoket 一般都是 json 数据格式传输，那么发生之前需要 JSON.stringify  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> my_stringify <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>stringify<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">stringify</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 debugger</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_stringify params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> my_parse <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">parse</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 debugger</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_parse params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_parse</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 2  webScoket 绑定在 windows 对象，上，根据浏览器的不同，websokcet 名字可能不一样 </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//chrome window.WebSocket  firfox window.MozWebSocket;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>window<span class=\"token punctuation\">.</span>_WebSocket <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>WebSocket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// hook send</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">_WebSocket</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">send</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hook WebSocket\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"WebSocket\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> WebSocket<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"11-hook-canvas-定位图片生成的地方\"><a class=\"anchor\" href=\"#11-hook-canvas-定位图片生成的地方\">#</a> 11 hook canvas (定位图片生成的地方)</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> create_element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>doument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    document<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createElement</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create_element:\"</span><span class=\"token punctuation\">,</span>_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_element <span class=\"token operator\">===</span> <span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">create_element</span><span class=\"token punctuation\">(</span>_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"12-setinterval-定时器\"><a class=\"anchor\" href=\"#12-setinterval-定时器\">#</a> 12 setInterval 定时器</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    setInterval_ <span class=\"token operator\">=</span> setInterval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"原函数已被重命名为setInterval_\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function-variable function\">setInterval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    setInterval<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"有函数正在检测setInterval是否被hook\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> setInterval_<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"13-setinterval-循环清除定时器\"><a class=\"anchor\" href=\"#13-setinterval-循环清除定时器\">#</a> 13 setInterval 循环清除定时器</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">9999999</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"14-过药监局无限debugger\"><a class=\"anchor\" href=\"#14-过药监局无限debugger\">#</a> 14 过药监局无限 debugger</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> _constructor <span class=\"token operator\">=</span> constructor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">constructor</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_constructor</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// ---------------------------------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> _Function <span class=\"token operator\">=</span> Function<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function-variable function\">Function</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_Function</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "JS逆向"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/spider/Xpath%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/spider/Xpath%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/",
            "title": "xpath 高级用法",
            "date_published": "2024-03-01T08:26:39.599Z",
            "content_html": "<h3 id=\"xpath-高级用法\"><a class=\"anchor\" href=\"#xpath-高级用法\">#</a> xpath 高级用法</h3>\n<h4 id=\"1-匹配当前节点下的所有\"><a class=\"anchor\" href=\"#1-匹配当前节点下的所有\">#</a> 1. 匹配当前节点下的所有： .//</h4>\n<p>. 表示当前</p>\n<p>// 表示当前标签下的所有标签</p>\n<p>注： 要配合使用</p>\n<hr />\n<h4 id=\"2-匹配某标签的属性值-属性名称\"><a class=\"anchor\" href=\"#2-匹配某标签的属性值-属性名称\">#</a> 2. 匹配某标签的属性值： /@属性名称</h4>\n<p>这里以 input 里的 value 值为例：</p>\n<p>例：xpath (//input/@value)</p>\n<hr />\n<h4 id=\"3-匹配多个路径\"><a class=\"anchor\" href=\"#3-匹配多个路径\">#</a> 3. 匹配多个路径：|</h4>\n<p>在一个 xpath 中写的多个表达式用 | 分开， 每个表达式互不干扰。</p>\n<p>例：xpath (&quot;//tr [6]/td [2]/text () | //tr [7]/td [2]/text ()&quot;)</p>\n<hr />\n<h4 id=\"4按属性匹配\"><a class=\"anchor\" href=\"#4按属性匹配\">#</a> 4. 按属性匹配：@</h4>\n<p>获取所有 id=&quot;test&quot; 的所有文本内容</p>\n<p>xpath('//*[@id=&quot;test&quot;]//text()')</p>\n<hr />\n<h4 id=\"5-匹配不包含某个属性的标签-not\"><a class=\"anchor\" href=\"#5-匹配不包含某个属性的标签-not\">#</a> 5. 匹配不包含某个属性的标签 not</h4>\n<p>多用于表格中匹配中不包含表头信息的数据</p>\n<p>例：xpath ('//table/tr [not (@class=&quot;tbhead&quot;)]')</p>\n<hr />\n<h4 id=\"6-匹配包含多个属性的标签-and\"><a class=\"anchor\" href=\"#6-匹配包含多个属性的标签-and\">#</a> 6. 匹配包含多个属性的标签: and</h4>\n<p>匹配所有的 tr 中不包含 tbhead 属性 和包含 head 的 tr 标签</p>\n<p>xpath('//table/tr[not(@class=&quot;tbhead&quot;) and @class=&quot;head&quot;]')</p>\n<hr />\n<h4 id=\"7-匹配包含不同属性的名称相同的标签-or\"><a class=\"anchor\" href=\"#7-匹配包含不同属性的名称相同的标签-or\">#</a> 7. 匹配包含不同属性的名称相同的标签: or</h4>\n<p>匹配包含 class=&quot;speedbar&quot; 或者 class=&quot;content-wrap&quot; 的标签</p>\n<p>例：xpath（'//div [@class=&quot;speedbar&quot; or @class=&quot;content-wrap&quot;]'）</p>\n<hr />\n<h4 id=\"8-将对象还原为字符串etreetostring\"><a class=\"anchor\" href=\"#8-将对象还原为字符串etreetostring\">#</a> 8. 将对象还原为字符串：etree.tostring（）</h4>\n<p>将匹配到的对象，作为 etree.tostring（）的参数即可， 注： 返回字符串</p>\n<p>sObj = xml.xpath ('//*[@id=&quot;test&quot;]')[0] #使用 xpath 定位一个节点</p>\n<p>sStr = etree.tostring(sObj)</p>\n<hr />\n<h4 id=\"9按轴axes匹配\"><a class=\"anchor\" href=\"#9按轴axes匹配\">#</a> 9. 按轴 (Axes) 匹配</h4>\n<h5 id=\"91-选取当前节点的所有子元素-child\"><a class=\"anchor\" href=\"#91-选取当前节点的所有子元素-child\">#</a> 9.1 选取当前节点的所有子元素: child</h5>\n<p>获取 div 下的 tr 的标签</p>\n<p>例：xpath ('//div [@id=&quot;testid&quot;]/child::tr/td/text ()') # 感觉这种方法鸡肋， //div [@id=&quot;testid&quot;]//tr/td 也可以实现</p>\n<h5 id=\"92-选取当前节点的所有属性attribute\"><a class=\"anchor\" href=\"#92-选取当前节点的所有属性attribute\">#</a> 9.2 选取当前节点的所有属性：attribute</h5>\n<p>获取 div 标签所有的属性值</p>\n<p>例： xpath ('//div/attribute::<em>') # 感觉这种方法鸡肋，//div/@</em> 同样能实现</p>\n<h5 id=\"93-ancestor父辈元素-ancestor-or-self父辈元素及当前元素\"><a class=\"anchor\" href=\"#93-ancestor父辈元素-ancestor-or-self父辈元素及当前元素\">#</a> 9.3 ancestor：父辈元素 /ancestor-or-self：父辈元素及当前元素</h5>\n<p>获取父辈元素的 div 的所有属性值， 在不好定位的情况下，通过孩子标签定位，这种方法可以用</p>\n<p>xpath('//div[@id=&quot;test&quot;]/ancestor::div/@*')</p>\n<p>xpath('//div[@id=&quot;test&quot;]/ancestor-or-self::div/@*')</p>\n<h5 id=\"94-descendant后代-descendant-or-self后代及当前节点本身\"><a class=\"anchor\" href=\"#94-descendant后代-descendant-or-self后代及当前节点本身\">#</a> 9.4 descendant：后代 /descendant-or-self：后代及当前节点本身</h5>\n<p>获取孩子元素的 div 的所有属性值，感觉鸡肋</p>\n<p>xpath('//div[@id=&quot;test&quot;]/descendant::div/@*')</p>\n<p>xpath('//div[@id=&quot;test&quot;]/descendant-or-self::div/@*')</p>\n<h5 id=\"95-选取当前节点的所有命名空间节点namespace\"><a class=\"anchor\" href=\"#95-选取当前节点的所有命名空间节点namespace\">#</a> 9.5 选取当前节点的所有命名空间节点:namespace</h5>\n<p>xpath('//div[@id=&quot;test&quot;]/namespace:😗')</p>\n<h5 id=\"96-定位position\"><a class=\"anchor\" href=\"#96-定位position\">#</a> 9.6 定位:position</h5>\n<p>和通过下标定位一样， 方法鸡肋</p>\n<p>xpath('//*[@id=&quot;test&quot;]/ol/li[position()=2]/text()')</p>\n<hr />\n<h4 id=\"10xpath-函数\"><a class=\"anchor\" href=\"#10xpath-函数\">#</a> 10.Xpath 函数：</h4>\n<h5 id=\"101统计数量count\"><a class=\"anchor\" href=\"#101统计数量count\">#</a> 10.1 统计数量：count</h5>\n<p>统计符合要求节点的数量， 注： 返回字符串</p>\n<p>xpath('count(//tr[@info])')</p>\n<h5 id=\"102字符串拼接-concat\"><a class=\"anchor\" href=\"#102字符串拼接-concat\">#</a> 10.2 字符串拼接 ：concat</h5>\n<p>统计出来的两个内容的字符串进行 “+” 处理， 注： 返回字符串</p>\n<p>xpath('concat(//li[@id=&quot;one&quot;]/text(),//li[@id=&quot;three&quot;]/text())')</p>\n<h5 id=\"103-解析当前节点下的字符string\"><a class=\"anchor\" href=\"#103-解析当前节点下的字符string\">#</a> 10.3 解析当前节点下的字符：string</h5>\n<p>string () 直解析匹配的第一个标签的值， 注： 返回字符串</p>\n<p>xpath('string(//tr)')</p>\n<p>element.xpath ('string (.)') #获取 element 下的所有文本</p>\n<h5 id=\"104-获取当前节点的节点名称-local-name\"><a class=\"anchor\" href=\"#104-获取当前节点的节点名称-local-name\">#</a> 10.4 获取当前节点的节点名称: local-name</h5>\n<p>返回当前属性的节点名称， 注： 返回字符串</p>\n<p>xpath('local-name(//*[@id=&quot;test&quot;])')</p>\n<h5 id=\"105-以指定的字符开头starts-with\"><a class=\"anchor\" href=\"#105-以指定的字符开头starts-with\">#</a> 10.5 以指定的字符开头：starts-with</h5>\n<p>starts-with 定位属性值以 8 开头的 li 元素</p>\n<p>xpath('//tr[starts-with(@code,&quot;one&quot;)]/text()')</p>\n<h5 id=\"106-小于\"><a class=\"anchor\" href=\"#106-小于\">#</a> 10.6 小于：&lt;</h5>\n<p>匹配所有 tr 标签属性 info 小于 200 的内容</p>\n<p>xpath('//tr[@info&lt;200]/text()')</p>\n<h5 id=\"107-查看元素是否存在boolean\"><a class=\"anchor\" href=\"#107-查看元素是否存在boolean\">#</a> 10.7 查看元素是否存在：boolean</h5>\n<p>boolean(./td[1]/img)</p>\n<hr />\n<h5 id=\"11-根据指定的文本内容选择\"><a class=\"anchor\" href=\"#11-根据指定的文本内容选择\">#</a> 11. 根据指定的文本内容选择</h5>\n<h5 id=\"111-相对定位指定的文本内容可以是文本内容的部分-也可以是全部\"><a class=\"anchor\" href=\"#111-相对定位指定的文本内容可以是文本内容的部分-也可以是全部\">#</a> 11.1 相对定位，指定的文本内容可以是文本内容的部分， 也可以是全部</h5>\n<p>//div [2]/ul/li [contains (text (), &quot;指定的文本内容&quot;)]/span/text ()</p>\n<h5 id=\"112-精准定位目标文本和搜索文本完全一致\"><a class=\"anchor\" href=\"#112-精准定位目标文本和搜索文本完全一致\">#</a> 11.2 精准定位，目标文本和搜索文本完全一致</h5>\n<p>//div [2]/ul/li [text ()=&quot;指定的文本内容&quot;]/span/text ()</p>\n<hr />\n<h4 id=\"12-通过文本内容定位兄弟标签的文本内容\"><a class=\"anchor\" href=\"#12-通过文本内容定位兄弟标签的文本内容\">#</a> 12. 通过文本内容定位兄弟标签的文本内容</h4>\n<p>//span [@class='tbtitem' and text ()=' 使用语言：']/following-sibling::text ()</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 定位【英语】</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tbtitem ys<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    页数：</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>3\\r\\n <span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span>\\r\\n</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tbtitem<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    使用语言：</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>英语 \\r\\n\\t\\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><em>注： 以上内容， 除标注外， 均返回列表！！</em></p>\n<hr />\n<h4 id=\"13-position定位\"><a class=\"anchor\" href=\"#13-position定位\">#</a> 13. position：定位</h4>\n<p>选择偶数项：td [position ()=(position () mod 2 = 0)]</p>\n<p>选择奇数项：td [position ()=(position () mod 2 != 0)]</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>find_elements_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'//td[contains(text(),\"核注清单\")]/ancestor::tr/td[position()=(position() mod 2 != 0)]'</span></span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"14-查看元素的网页源码\"><a class=\"anchor\" href=\"#14-查看元素的网页源码\">#</a> 14. 查看元素的网页源码</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a <span class=\"token operator\">=</span> html2<span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'//table[@class=\"zebra\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>etree<span class=\"token punctuation\">.</span>tostring<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "spider"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/python/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/python/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "title": "定时任务",
            "date_published": "2024-03-01T03:01:23.053Z",
            "content_html": "<h4 id=\"1-schedule\"><a class=\"anchor\" href=\"#1-schedule\">#</a> 1 schedule</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> schedule</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># 这里是你要执行的任务代码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行任务\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 设定每天的特定时间，例如每天 23:59:59</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>schedule<span class=\"token punctuation\">.</span>every<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>day<span class=\"token punctuation\">.</span>at<span class=\"token punctuation\">(</span><span class=\"token string\">\"23:59:59\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>do<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 每小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":00\").do(job)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 每小时的 30 分钟，执行一次</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":30\").do(job)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 循环调度任务</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    schedule<span class=\"token punctuation\">.</span>run_pending<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"2-blockingscheduler推荐\"><a class=\"anchor\" href=\"#2-blockingscheduler推荐\">#</a> 2 BlockingScheduler（推荐）</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> apscheduler<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>blocking <span class=\"token keyword\">import</span> BlockingScheduler</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>shanghai <span class=\"token operator\">=</span> <span class=\"token string\">'Asia/Shanghai'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 创建调度器</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>scheduler <span class=\"token operator\">=</span> BlockingScheduler<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>timezone<span class=\"token operator\">=</span>shanghai<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每 2 小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> hours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每月 1 号凌晨 0 点执行</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'cron'</span><span class=\"token punctuation\">,</span> month<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> day<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> hour<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> minute<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> second<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 启动调度器</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"参数说明\"><a class=\"anchor\" href=\"#参数说明\">#</a> 参数说明</h5>\n<ul>\n<li>\n<p>weeks (int) – 隔多少周执行一次任务</p>\n</li>\n<li>\n<p>days (int) – 隔多少天执行一次任务</p>\n</li>\n<li>\n<p>hours (int) – 隔多少个小时执行一次任务</p>\n</li>\n<li>\n<p>minutes (int) – 隔几分钟执行一次任务</p>\n</li>\n<li>\n<p>seconds (int) – 隔几秒执行一次任务</p>\n</li>\n<li>\n<p>start_date - 指定开始时间 (datetime|str) – starting point for the interval calculation</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>end_date - 指定结束时间</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>timezone - 时区，中国就用 'Asia/Shanghai' 就行</p>\n</li>\n<li>\n<p>jitter 时间偏移量，单位秒</p>\n<ul>\n<li>\n<p>在预定运行时间的基础上，加上一个随机的秒数</p>\n<p>例如 预定运行时间为 10:20:20 偏移量为 10 则真实运行时间期间为 [10:20:20-10:20:30]</p>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"形参说明\"><a class=\"anchor\" href=\"#形参说明\">#</a> 形参说明</h5>\n<p>如果要执行的任务需要参数，可以通过 scheduler.add_job (args=(a,b)) 进行添加</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> arghours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure>",
            "tags": [
                "python"
            ]
        }
    ]
}