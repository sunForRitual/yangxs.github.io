{
    "version": "https://jsonfeed.org/version/1",
    "title": "(人 •͈ᴗ•͈) ♡♡",
    "subtitle": "不用担心，这次肯定不会有问题",
    "icon": "https://sunforritual.github.io/yangxs.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://sunforritual.github.io/yangxs.github.io",
    "items": [
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/selenium_3.141.0/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/selenium_3.141.0/",
            "title": "selenium 3.141.0",
            "date_published": "2024-03-07T03:02:19.109Z",
            "content_html": "<p><span class=\"exturl\" data-url=\"aHR0cDovL2Nocm9tZWRyaXZlci5zdG9yYWdlLmdvb2dsZWFwaXMuY29tL2luZGV4Lmh0bWw=\">Google 浏览器驱动程序下载地址</span></p>\n<h3 id=\"一-安装\"><a class=\"anchor\" href=\"#一-安装\">#</a> 一、安装</h3>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>pip install selenium</pre></td></tr></table></figure><h3 id=\"二-常用\"><a class=\"anchor\" href=\"#二-常用\">#</a> 二、常用</h3>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>by <span class=\"token keyword\">import</span> By</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver <span class=\"token keyword\">import</span> ActionChains</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>ui <span class=\"token keyword\">import</span> WebDriverWait</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support <span class=\"token keyword\">import</span> expected_conditions <span class=\"token keyword\">as</span> EC</pre></td></tr></table></figure><figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>CHROME_DRIVER <span class=\"token operator\">=</span> <span class=\"token string\">r'D:\\software\\anaconda3\\Scripts\\chromedriver.exe'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>chrome_options <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>ChromeOptions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 设置 屏幕大小</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"window-size=1366,768\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># chrome_options.add_argument('--headless')</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"-no-sandbox\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># chrome_options.add_argument(\"--disable-dev-shm-usage\")</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_experimental_option<span class=\"token punctuation\">(</span><span class=\"token string\">'excludeSwitches'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'enable-automation'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_experimental_option<span class=\"token punctuation\">(</span><span class=\"token string\">'prefs'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">\"download.default_directory\"</span><span class=\"token punctuation\">:</span> config<span class=\"token punctuation\">.</span>wgbgd_save<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token string\">\"download.prompt_for_download\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token string\">\"download.directory_upgrade\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token string\">\"plugins.always_open_pdf_externally\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span>  </pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span>CHROME_DRIVER<span class=\"token punctuation\">,</span> chrome_options<span class=\"token operator\">=</span>chrome_options<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>wait <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 等待</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>wait<span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">.</span>presence_of_element_located<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> <span class=\"token string\">'cardLogin'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>wait<span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">.</span>element_to_be_clickable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> <span class=\"token string\">'cusAdvancedQuery'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\"># 等待页面所有元素加载完成</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>wait<span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">.</span>presence_of_all_elements_located<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>CSS_SELECTOR<span class=\"token punctuation\">,</span> <span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>bgd_url<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>handles <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>window_handles <span class=\"token comment\"># 获取所有页面的句柄</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">(</span>handles<span class=\"token punctuation\">[</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#切换页面</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>driver<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"三-入门\"><a class=\"anchor\" href=\"#三-入门\">#</a> 三、入门</h3>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 创建 Chrome 参数对象</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>chrome_options <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>ChromeOptions<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#无界面模式</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#chrome_options.add_argument('--headless') </span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 浏览器驱动位置</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>path <span class=\"token operator\">=</span> <span class=\"token string\">r\"D:\\software\\anaconda3\\Scripts\\chromedriver.exe\"</span>  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 获取 Chrome 驱动实例</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span>executable_path<span class=\"token operator\">=</span>path<span class=\"token punctuation\">,</span> options<span class=\"token operator\">=</span>opt<span class=\"token punctuation\">)</span>  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'http://ww.baidu.com/'</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 打开指定网址页面</span></pre></td></tr></table></figure><figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">.</span>page_source<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 输出网页的源代码</span></pre></td></tr></table></figure><h4 id=\"31-查找元素\"><a class=\"anchor\" href=\"#31-查找元素\">#</a> 3.1 查找元素</h4>\n<p>查找以下元素： <code>&lt;input type=&quot;text&quot; name=&quot;passwd&quot; id=&quot;passwd-id&quot; /&gt;</code></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">\"passwd-id\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>element <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"passwd\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>element <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"//input[@id='passwd-id']\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>find_element_by_link_text  <span class=\"token comment\"># 通过 & lt;a>..&lt;/a > 中的内容获取，属性 href 的值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>find_element_by_partial_link_text</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>find_element_by_tag_name  <span class=\"token comment\"># 通过标签名定位</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>find_element_by_class_name</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>find_element_by_css_selector</pre></td></tr></table></figure><hr />\n<h4 id=\"321-获取元素的属性值\"><a class=\"anchor\" href=\"#321-获取元素的属性值\">#</a> 3.2.1 获取元素的属性值</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element<span class=\"token punctuation\">.</span>get_attribute<span class=\"token punctuation\">(</span><span class=\"token string\">\"name\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"322-获取css属性值\"><a class=\"anchor\" href=\"#322-获取css属性值\">#</a> 3.2.2 获取 css 属性值</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element<span class=\"token punctuation\">.</span>value_of_css_property<span class=\"token punctuation\">(</span><span class=\"token string\">'display'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"33-弹出对话框处理弹窗\"><a class=\"anchor\" href=\"#33-弹出对话框处理弹窗\">#</a> 3.3 弹出对话框处理，弹窗</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>alert <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>switch_to_alert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 或</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>alert <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>alert<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 常用</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>alert<span class=\"token punctuation\">.</span>accept<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 弹窗确定</span></pre></td></tr></table></figure><p>这个接口对 alert, confirm， prompt 对话框效果相同</p>\n<hr />\n<h4 id=\"34-访问浏览器历史记录\"><a class=\"anchor\" href=\"#34-访问浏览器历史记录\">#</a> 3.4 访问浏览器历史记录</h4>\n<pre><code>driver.get(&quot;http://www.example.com&quot;)\n</code></pre>\n<p>在浏览历史中前进和后退你可以使用:</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>forward<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>driver<span class=\"token punctuation\">.</span>back<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"35-获取当前窗口的截图\"><a class=\"anchor\" href=\"#35-获取当前窗口的截图\">#</a> 3.5 获取当前窗口的截图</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Firefox<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">'http://www.python.org/'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>driver<span class=\"token punctuation\">.</span>save_screenshot<span class=\"token punctuation\">(</span><span class=\"token string\">'screenshot.png'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>driver<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"35-避免自动操作检测\"><a class=\"anchor\" href=\"#35-避免自动操作检测\">#</a> 3.5 避免自动操作检测</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_cdp_cmd<span class=\"token punctuation\">(</span><span class=\"token string\">\"Page.addScriptToEvaluateOnNewDocument\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        <span class=\"token string\">\"source\"</span><span class=\"token punctuation\">:</span> <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>                Object.defineProperty(navigator, 'webdriver', &#123;</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>                  get: () => undefined</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                &#125;)</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>              \"\"\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"37-窗口最大化\"><a class=\"anchor\" href=\"#37-窗口最大化\">#</a> 3.7 窗口最大化</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>maximize_window<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"38-切换iframe\"><a class=\"anchor\" href=\"#38-切换iframe\">#</a> 3.8 切换 iframe</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>iframe <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">'menu'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>frame<span class=\"token punctuation\">(</span>iframe<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"381-通过元素的id-或name属性切换\"><a class=\"anchor\" href=\"#381-通过元素的id-或name属性切换\">#</a> 3.8.1 通过元素的 id 或 name 属性切换</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">,</span>switch_to_frame<span class=\"token punctuation\">(</span><span class=\"token string\">''</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">#参数传 frame id 或者 name</span></pre></td></tr></table></figure><h5 id=\"382-通过元素索引切换\"><a class=\"anchor\" href=\"#382-通过元素索引切换\">#</a> 3.8.2 通过元素索引切换</h5>\n<p>#通过索引切换 注意索引从 0 开始  注意 只有同级可以使用 索引切换 如果是嵌套的 frame 是不能使用索引切换的</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>frame<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"383-通过定位元素的方式切换\"><a class=\"anchor\" href=\"#383-通过定位元素的方式切换\">#</a> 3.8.3 通过定位元素的方式切换</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>frame<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">.</span>find_elements_by_tag_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"iframe\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"384-切换嵌套iframe\"><a class=\"anchor\" href=\"#384-切换嵌套iframe\">#</a> 3.8.4 切换嵌套 iframe</h5>\n<p>同上 可以先切换到父 iframe  然后再切换到子 iframe</p>\n<h5 id=\"385-从子iframe-切换到父级-iframe\"><a class=\"anchor\" href=\"#385-从子iframe-切换到父级-iframe\">#</a> 3.8.5 从子 iframe 切换到父级 iframe</h5>\n<pre><code>driver.switch_to.parent_frame()\n</code></pre>\n<h5 id=\"386-切换回主文档-即跳出所有iframe\"><a class=\"anchor\" href=\"#386-切换回主文档-即跳出所有iframe\">#</a> 3.8.6 切换回主文档  ，即跳出所有 iframe</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>switch_to<span class=\"token punctuation\">.</span>default_content<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>————————————————<br />\n 版权声明：本文为 CSDN 博主「词穷墨尽」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br />\n原文链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTE2NzE1MC9hcnRpY2xlL2RldGFpbHMvMTA5NTIyNjg1\">https://blog.csdn.net/weixin_41167150/article/details/109522685</span></p>\n<hr />\n<h3 id=\"四-等待\"><a class=\"anchor\" href=\"#四-等待\">#</a> 四、等待</h3>\n<p><strong>显式等待</strong>会让 WebDriver 等待满足一定的条件以后再进一步的执行。</p>\n<p><strong>隐式等待</strong>设置一个全局的最长等待时间，在查找元素时等待一段时间，如果元素在这个时间内找到了就立即执行操作，如果超过了这个时间还没有找到元素，则抛出异常。</p>\n<h4 id=\"41-显式等待\"><a class=\"anchor\" href=\"#41-显式等待\">#</a> 4.1 显式等待</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>by <span class=\"token keyword\">import</span> By</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>ui <span class=\"token keyword\">import</span> WebDriverWait</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support <span class=\"token keyword\">import</span> expected_conditions <span class=\"token keyword\">as</span> EC</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Firefox<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"http://somedomain/url_that_delays_loading\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\"># 等待，直到 id=myDynamicElement 的元素加载后在继续执行</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    element <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">.</span>presence_of_element_located<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> <span class=\"token string\">\"myDynamicElement\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\"># 等待，直到 id=cusAdvancedQuery 的元素，可被点击后继续执行</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    element <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>until<span class=\"token punctuation\">(</span>EC<span class=\"token punctuation\">.</span>element_to_be_clickable<span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>By<span class=\"token punctuation\">.</span>ID<span class=\"token punctuation\">,</span> <span class=\"token string\">'cusAdvancedQuery'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">finally</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    driver<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>等待 10s，如果 10s 内 id=myDynamicElement 的元素加载成功，则直接进入下一步。</p>\n<h4 id=\"42-隐式等待\"><a class=\"anchor\" href=\"#42-隐式等待\">#</a> 4.2 隐式等待</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Firefox<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>driver<span class=\"token punctuation\">.</span>implicitly_wait<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># 设置全局的最长等待时间</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token string\">\"http://somedomain/url_that_delays_loading\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>myDynamicElement <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">\"myDynamicElement\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>隐式等待可以理解成在规定的时间范围内，浏览器在不停的刷新页面，直到找到相关元素或者时间结束。</p>\n<hr />\n<h4 id=\"关闭\"><a class=\"anchor\" href=\"#关闭\">#</a> 关闭</h4>\n<p>关闭浏览器窗口，可以使用 quit 方法代替 close 方法， quit 将关闭整个浏览器，而 close 只会关闭一个标签页， 如果你只打开了一个标签页，大多数浏览器的默认行为是关闭浏览器。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element<span class=\"token punctuation\">.</span>clear<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>element<span class=\"token punctuation\">.</span>quit<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"五-截图\"><a class=\"anchor\" href=\"#五-截图\">#</a> 五、截图</h3>\n<h4 id=\"1-指定元素截图\"><a class=\"anchor\" href=\"#1-指定元素截图\">#</a> 1、指定元素截图</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>img <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">'image1'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>img<span class=\"token punctuation\">.</span>screenshot<span class=\"token punctuation\">(</span><span class=\"token string\">'./code.png'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"2-网页全屏截图\"><a class=\"anchor\" href=\"#2-网页全屏截图\">#</a> 2、网页全屏截图</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>save_screenshot<span class=\"token punctuation\">(</span><span class=\"token string\">'./full_snap.png'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"六-模拟鼠标键盘操作\"><a class=\"anchor\" href=\"#六-模拟鼠标键盘操作\">#</a> 六、模拟鼠标 / 键盘操作</h3>\n<h4 id=\"61-输入内容\"><a class=\"anchor\" href=\"#61-输入内容\">#</a> 6.1 输入内容</h4>\n<p>模拟键盘输入操作</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element<span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span><span class=\"token string\">\"some text\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>还可以通过”Keys” 类来模式输入方向键</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element<span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span><span class=\"token string\">\" and some\"</span><span class=\"token punctuation\">,</span> Keys<span class=\"token punctuation\">.</span>ARROW_DOWN<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><pre><code>1、回车键：Keys.ENTER\n2、删除键：Keys.BACK_SPACE\n3、空格键：Keys.SPACE\n4、制表键：Keys.TAB\n5、回退键：Keys.ESCAPE\n6、刷新键：Keys.F5\n7、删除输入框内结尾的单个字符：Keys.BACK_SPACE  \n# Keys.LEFT 光标左移\ndr.find_element_by_id(&quot;kw&quot;).send_keys(Keys.LEFT * 3)\n# shift + right 右移光标选中\ndr.find_element_by_id(&quot;kw&quot;).send_keys(Keys.SHIFT, Keys.RIGHT * 3)\n</code></pre>\n<p>常用组合键操作 Ctrl+__</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>1、全选：send_keys(Keys.CONTROL,'a')</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>2、复制：send_keys(Keys.CONTROL,'c')</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>3、粘贴：send_keys(Keys.CONTROL,'v')</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>4、剪切：send_keys(Keys.CONTROL,'x')</pre></td></tr></table></figure><p>使用 ActionChains 类可以达到相同的效果</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">\"passwd-id\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 初始化一个 ActionChains 类</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>action <span class=\"token operator\">=</span> ActionChains<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 选中内容</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>action<span class=\"token punctuation\">.</span>key_down<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span><span class=\"token string\">'a'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>key_up<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 复制内容</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>action<span class=\"token punctuation\">.</span>key_down<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span><span class=\"token string\">'c'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>key_up<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 粘贴内容</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>action<span class=\"token punctuation\">.</span>key_down<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>send_keys<span class=\"token punctuation\">(</span><span class=\"token string\">'v'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>key_up<span class=\"token punctuation\">(</span>Keys<span class=\"token punctuation\">.</span>CONTROL<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"62-多选框选择操作\"><a class=\"anchor\" href=\"#62-多选框选择操作\">#</a> 6.2 多选框选择操作</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>ui <span class=\"token keyword\">import</span> Select</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>select <span class=\"token operator\">=</span> Select<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">'name'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>select<span class=\"token punctuation\">.</span>select_by_index<span class=\"token punctuation\">(</span>index<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>select<span class=\"token punctuation\">.</span>select_by_visible_text<span class=\"token punctuation\">(</span><span class=\"token string\">\"text\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>select<span class=\"token punctuation\">.</span>select_by_value<span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"621-取消已经选择的一些元素\"><a class=\"anchor\" href=\"#621-取消已经选择的一些元素\">#</a> 6.2.1 取消已经选择的一些元素</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>select <span class=\"token operator\">=</span> Select<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">'id'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>select<span class=\"token punctuation\">.</span>deselect_all<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"622-列出所有已经选择的选项\"><a class=\"anchor\" href=\"#622-列出所有已经选择的选项\">#</a> 6.2.2 列出所有已经选择的选项</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>select <span class=\"token operator\">=</span> Select<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">.</span>find_element_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string\">\"xpath\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>all_selected_options <span class=\"token operator\">=</span> select<span class=\"token punctuation\">.</span>all_selected_options</pre></td></tr></table></figure><h5 id=\"623-获得所以选项\"><a class=\"anchor\" href=\"#623-获得所以选项\">#</a> 6.2.3 获得所以选项</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>options <span class=\"token operator\">=</span> select<span class=\"token punctuation\">.</span>options</pre></td></tr></table></figure><hr />\n<h4 id=\"63-拖放\"><a class=\"anchor\" href=\"#63-拖放\">#</a> 6.3 拖放</h4>\n<p>可以使用拖放，无论是移动一个元素，或放到另一个元素内:</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>element <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>target <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"target\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver <span class=\"token keyword\">import</span> ActionChains</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>action_chains <span class=\"token operator\">=</span> ActionChains<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>action_chains<span class=\"token punctuation\">.</span>drag_and_drop<span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"64-页面滚动\"><a class=\"anchor\" href=\"#64-页面滚动\">#</a> 6.4 页面滚动</h4>\n<h5 id=\"641-滚动到页面底部\"><a class=\"anchor\" href=\"#641-滚动到页面底部\">#</a> 6.4.1 滚动到页面底部</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span><span class=\"token string\">\"window.scrollTo(0, document.body.scrollHeight);\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"642-滚动到指定为止\"><a class=\"anchor\" href=\"#642-滚动到指定为止\">#</a> 6.4.2 滚动到指定为止</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span><span class=\"token string\">\"document.documentElement.scrollTop = 11245\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"643-循环滚动到指定为止\"><a class=\"anchor\" href=\"#643-循环滚动到指定为止\">#</a> 6.4.3 循环滚动到指定为止</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10767</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    js_code <span class=\"token operator\">=</span> <span class=\"token string-interpolation\"><span class=\"token string\">f'document.documentElement.scrollTop = </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>i<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">'</span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span>js_code<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"65-鼠标悬浮\"><a class=\"anchor\" href=\"#65-鼠标悬浮\">#</a> 6.5 鼠标悬浮</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>action_chains <span class=\"token keyword\">import</span> ActionChains</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>app_top <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">'AppTop_currentli'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 将鼠标放置在 app_top 元素上</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>my_action<span class=\"token punctuation\">.</span>move_to_element<span class=\"token punctuation\">(</span>app_top<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"66-鼠标点击事件\"><a class=\"anchor\" href=\"#66-鼠标点击事件\">#</a> 6.6 鼠标点击事件</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>action_chains <span class=\"token keyword\">import</span> ActionChains</pre></td></tr></table></figure><h5 id=\"661-右击\"><a class=\"anchor\" href=\"#661-右击\">#</a> 6.6.1 右击</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rc <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">\"rightclickid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ActionChains<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>context_click<span class=\"token punctuation\">(</span>rc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"662-双击\"><a class=\"anchor\" href=\"#662-双击\">#</a> 6.6.2 双击</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>rc <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_id<span class=\"token punctuation\">(</span><span class=\"token string\">\"rightclickid\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ActionChains<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>double_click<span class=\"token punctuation\">(</span>rc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"663-移动\"><a class=\"anchor\" href=\"#663-移动\">#</a> 6.6.3 移动</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#定位元素的原位置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>element <span class=\"token operator\">=</span> driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"source\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#定位元素要移动到的目标位置</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>target <span class=\"token operator\">=</span>  driver<span class=\"token punctuation\">.</span>find_element_by_name<span class=\"token punctuation\">(</span><span class=\"token string\">\"target\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#执行元素的移动操作</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ActionChains<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>drag_and_drop<span class=\"token punctuation\">(</span>element<span class=\"token punctuation\">,</span> target<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>perform<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"67-模拟鼠标滚动\"><a class=\"anchor\" href=\"#67-模拟鼠标滚动\">#</a> 6.7 模拟鼠标滚动</h4>\n<h5 id=\"671-滚动到页面底部\"><a class=\"anchor\" href=\"#671-滚动到页面底部\">#</a> 6.7.1 滚动到页面底部</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>js <span class=\"token operator\">=</span> <span class=\"token string\">\"window.scrollTo(0, document.body.scrollHeight)\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span>js<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"672-滚动到页面顶部\"><a class=\"anchor\" href=\"#672-滚动到页面顶部\">#</a> 6.7.2 滚动到页面顶部</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>js <span class=\"token operator\">=</span> <span class=\"token string\">\"window.scrollTo(0, 0)\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span>js<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"673-指定滚动距离\"><a class=\"anchor\" href=\"#673-指定滚动距离\">#</a> 6.7.3 指定滚动距离</h5>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>js <span class=\"token operator\">=</span> <span class=\"token string\">\"document.documentElement.scrollTop=7000\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>driver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span>js<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h3 id=\"七-运行js代码\"><a class=\"anchor\" href=\"#七-运行js代码\">#</a> 七、运行 js 代码</h3>\n<h4 id=\"71-获取浏览器中某个变量的值\"><a class=\"anchor\" href=\"#71-获取浏览器中某个变量的值\">#</a> 7.1 获取浏览器中某个变量的值</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>briver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span><span class=\"token string\">\"return 变量名\"</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"72-获取网页中的图片\"><a class=\"anchor\" href=\"#72-获取网页中的图片\">#</a> 7.2 获取网页中的图片</h4>\n<p>获取 canvas 标签生成的图片，</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>img_bs64 <span class=\"token operator\">=</span> briver<span class=\"token punctuation\">.</span>execute_script<span class=\"token punctuation\">(</span><span class=\"token string\">\"return document.getElementsByClassName('图片元素的class')[0].toDataURL('image/png')\"</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 返回涵图片 base64 位编码的字符串</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>img_base <span class=\"token operator\">=</span> img_bs64<span class=\"token punctuation\">.</span>split<span class=\"token punctuation\">(</span><span class=\"token string\">','</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span>   <span class=\"token comment\"># 截取图片的 base64 位编码的字符串</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>img_base <span class=\"token operator\">=</span> base64<span class=\"token punctuation\">.</span>b64decode<span class=\"token punctuation\">(</span>img_base<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 将 base64 编码数据转为 byte</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">with</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bg.png'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'wb'</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">as</span> f<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    f<span class=\"token punctuation\">.</span>write<span class=\"token punctuation\">(</span>img_base<span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "自动化",
                "web自动化"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/selenium_4.10/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/selenium_4.10/",
            "title": "selenium 4.10",
            "date_published": "2024-03-07T03:02:19.105Z",
            "content_html": "<h3 id=\"selenium-410\"><a class=\"anchor\" href=\"#selenium-410\">#</a> selenium 4.10</h3>\n<p>官方文档：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuc2VsZW5pdW0uZGV2L2RvY3VtZW50YXRpb24vd2ViZHJpdmVyLw==\">https://www.selenium.dev/documentation/webdriver/</span></p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> selenium <span class=\"token keyword\">import</span> webdriver</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>by <span class=\"token keyword\">import</span> By</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver <span class=\"token keyword\">import</span> ActionChains</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>common<span class=\"token punctuation\">.</span>keys <span class=\"token keyword\">import</span> Keys</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>chrome<span class=\"token punctuation\">.</span>options <span class=\"token keyword\">import</span> Options</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>chrome<span class=\"token punctuation\">.</span>service <span class=\"token keyword\">import</span> Service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support<span class=\"token punctuation\">.</span>ui <span class=\"token keyword\">import</span> WebDriverWait</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">from</span> selenium<span class=\"token punctuation\">.</span>webdriver<span class=\"token punctuation\">.</span>support <span class=\"token keyword\">import</span> expected_conditions <span class=\"token keyword\">as</span> EC</pre></td></tr></table></figure><figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>CHROME_DRIVER <span class=\"token operator\">=</span> <span class=\"token string\">r'D:\\software\\anaconda3\\Scripts\\chromedriver.exe'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>chrome_options <span class=\"token operator\">=</span> Options<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 设置 屏幕大小</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"window-size=1366,768\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token string\">'user-agent=Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 设置为开发者模式</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"no-sandbox\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">\"--disable-extensions\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 无头模式</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_argument<span class=\"token punctuation\">(</span><span class=\"token string\">'--headless'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># chrome_options.add_argument('blink-settings=imagesEnabled=false')</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_experimental_option<span class=\"token punctuation\">(</span><span class=\"token string\">'excludeSwitches'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'enable-automation'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 这个有时候影响人机检测</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>chrome_options<span class=\"token punctuation\">.</span>add_experimental_option<span class=\"token punctuation\">(</span><span class=\"token string\">'prefs'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token comment\"># \"download.default_directory\": bzdhzqd_save,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string\">\"download.prompt_for_download\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token string\">\"download.directory_upgrade\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token string\">\"plugins.always_open_pdf_externally\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\"># 这句配置很重要</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token string\">\"credentials_enable_service\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">,</span>    <span class=\"token comment\"># 禁止记住密码框弹出</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token string\">\"profile.password_manager_enabled\"</span><span class=\"token punctuation\">:</span> <span class=\"token boolean\">False</span> </pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 可以不用设置浏览器驱动 service</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>service <span class=\"token operator\">=</span> Service<span class=\"token punctuation\">(</span>executable_path<span class=\"token operator\">=</span>config<span class=\"token punctuation\">.</span>CHROME_DRIVER<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>driver <span class=\"token operator\">=</span> webdriver<span class=\"token punctuation\">.</span>Chrome<span class=\"token punctuation\">(</span>service<span class=\"token operator\">=</span>service<span class=\"token punctuation\">,</span> options<span class=\"token operator\">=</span>chrome_options<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>wait <span class=\"token operator\">=</span> WebDriverWait<span class=\"token punctuation\">(</span>driver<span class=\"token punctuation\">,</span> <span class=\"token number\">40</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>driver<span class=\"token punctuation\">.</span>get<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>driver<span class=\"token punctuation\">.</span>implicitly_wait<span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>   <span class=\"token comment\"># 等待页面加载完毕，最多等待 10s</span></pre></td></tr></table></figure>",
            "tags": [
                "自动化",
                "web自动化"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/pyautogui%E8%87%AA%E5%8A%A8%E5%8C%96/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/07/%E8%87%AA%E5%8A%A8%E5%8C%96/pyautogui%E8%87%AA%E5%8A%A8%E5%8C%96/",
            "title": "pyautogui",
            "date_published": "2024-03-07T03:01:52.449Z",
            "content_html": "<p>注：pyautogui 只是能够控制鼠标和键盘事件，并不能提取屏幕中的文本信息</p>\n<h4 id=\"依赖安装\"><a class=\"anchor\" href=\"#依赖安装\">#</a> 依赖安装</h4>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>pip <span class=\"token function\">install</span> pyautogui</pre></td></tr></table></figure><h4 id=\"快速上手\"><a class=\"anchor\" href=\"#快速上手\">#</a> 快速上手</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> pyautogui</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 屏幕大小</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pyautogui<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 获取鼠标当前位置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pyautogui<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># 判断坐标是否在屏幕内 (x 的取值范围是 [0, 宽度分辨率 - 1]，y 的取值范围是 [0, 高度分辨率 - 1])</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pyautogui<span class=\"token punctuation\">.</span>onScreen<span class=\"token punctuation\">(</span><span class=\"token number\">1920</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"鼠标控制\"><a class=\"anchor\" href=\"#鼠标控制\">#</a> 鼠标控制</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 保存屏幕尺寸</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>screenX<span class=\"token punctuation\">,</span> screenY <span class=\"token operator\">=</span> pyautogui<span class=\"token punctuation\">.</span>size<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 绝对位置移动，移动到屏幕中央，鼠标移动过度时间 duration 为 1 秒</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>moveTo<span class=\"token punctuation\">(</span>screenX <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> screenY <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 相对位置移动，向右移动 100、向上移动 200，移动过度时间 duration 为 0.5 秒</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>moveRel<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>moveRel<span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>moveRel<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">200</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 不指定 x、y，在当前位置点击一下右键</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span>button<span class=\"token operator\">=</span><span class=\"token string\">'right'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 移动至（100,100）点击 3 次左键，点击间隔 0.1s，鼠标移动过度时间 duration 为 0.5s</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> clicks<span class=\"token operator\">=</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\"># 移动至 (100,100) 点击 2 次右键，点击间隔 0.5s，鼠标移动过渡时间 0.2 秒</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span> button<span class=\"token operator\">=</span><span class=\"token string\">'right'</span><span class=\"token punctuation\">,</span> clicks<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># 将鼠标从当前位置拖至屏幕中心，默认点击左键</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>dragTo<span class=\"token punctuation\">(</span>screenX <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> screenY <span class=\"token operator\">/</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># 将鼠标从当前位置向左 100 像素、向右 200 像素拖动，过渡时间 0.5 秒，指定点击右键</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>dragRel<span class=\"token punctuation\">(</span><span class=\"token operator\">-</span><span class=\"token number\">100</span><span class=\"token punctuation\">,</span> <span class=\"token number\">200</span><span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">,</span> button<span class=\"token operator\">=</span><span class=\"token string\">'right'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"键盘控制\"><a class=\"anchor\" href=\"#键盘控制\">#</a> 键盘控制</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 键名用字符串表示，支持的所有键名，存在 pyautogui.KEYBOARD_KEYS 变量中，包括 26 个字母、数字、符号、F1~F20、方向等等所有按键</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 按字母 A 键，字母支持大小写</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>typewrite<span class=\"token punctuation\">(</span><span class=\"token string\">'A'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>typewrite<span class=\"token punctuation\">(</span><span class=\"token string\">'hello, PyAutoGUI!\\n'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># 传入键名列表（按键 p、按键 y、空格），按键之间间隔 0.1 秒（默认 0）</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>press<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">' '</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>typewrite<span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token string\">'capslock'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'p'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'y'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># hotkey 屏蔽了需要反复 keyDown、keyUp 的细节，参数是任意个键名，而非列表</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>hotkey<span class=\"token punctuation\">(</span><span class=\"token string\">'shift'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'shift'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'esc'</span><span class=\"token punctuation\">,</span> interval<span class=\"token operator\">=</span><span class=\"token number\">0.1</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"消息窗口\"><a class=\"anchor\" href=\"#消息窗口\">#</a> 消息窗口</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>alert<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span><span class=\"token string\">'警告'</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">'PyAutoGUI消息框'</span><span class=\"token punctuation\">,</span> button<span class=\"token operator\">=</span><span class=\"token string\">'OK'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>confirm<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span><span class=\"token string\">'请选择'</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">'PyAutoGUI消息框'</span><span class=\"token punctuation\">,</span> buttons<span class=\"token operator\">=</span><span class=\"token punctuation\">[</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'3'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>txt <span class=\"token operator\">=</span> pyautogui<span class=\"token punctuation\">.</span>prompt<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span><span class=\"token string\">'请输入'</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">'PyAutoGUI消息框'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">'请输入'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>pwd <span class=\"token operator\">=</span> pyautogui<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">(</span>text<span class=\"token operator\">=</span><span class=\"token string\">'输入密码'</span><span class=\"token punctuation\">,</span> title<span class=\"token operator\">=</span><span class=\"token string\">'PyAutoGUI消息框'</span><span class=\"token punctuation\">,</span> default<span class=\"token operator\">=</span><span class=\"token string\">''</span><span class=\"token punctuation\">,</span> mask<span class=\"token operator\">=</span><span class=\"token string\">'*'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"6-截图\"><a class=\"anchor\" href=\"#6-截图\">#</a> 6、截图</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># imageFilename 参数，截图要保存的文件全路径名，默认 `None`，不保存；</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># region 参数，截图区域，由左上角坐标、宽度、高度 4 个值确定，如果指定区域超出了屏幕范围，超出部分会被黑色填充，默认 `None`, 截全屏</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>screenshot<span class=\"token punctuation\">(</span><span class=\"token string\">'shot.png'</span><span class=\"token punctuation\">,</span> region<span class=\"token operator\">=</span><span class=\"token punctuation\">(</span><span class=\"token number\">1000</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">600</span><span class=\"token punctuation\">,</span> <span class=\"token number\">400</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"通过按钮图片定位按钮位置\"><a class=\"anchor\" href=\"#通过按钮图片定位按钮位置\">#</a> 通过按钮图片定位按钮位置</h4>\n<p>前提：需要安装  <code>opencv-python</code>  依赖</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> pyautogui</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> cv2</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> numpy <span class=\"token keyword\">as</span> np</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">get_img_button_position</span><span class=\"token punctuation\">(</span>img_path<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token triple-quoted-string string\">\"\"\"</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    获取按钮图片的在屏幕中的位置</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    :param img_path: 按钮图片路径</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    :return: 按钮图片的中心位置</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    \"\"\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    template <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>imread<span class=\"token punctuation\">(</span>img_path<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    w<span class=\"token punctuation\">,</span> h <span class=\"token operator\">=</span> template<span class=\"token punctuation\">.</span>shape<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\"># 截取屏幕图片</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    screenshot <span class=\"token operator\">=</span> pyautogui<span class=\"token punctuation\">.</span>screenshot<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    screenshot_np <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>array<span class=\"token punctuation\">(</span>screenshot<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    screenshot_gray <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>cvtColor<span class=\"token punctuation\">(</span>screenshot_np<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>COLOR_BGR2GRAY<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\"># 使用模板匹配找到按钮位置</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    res <span class=\"token operator\">=</span> cv2<span class=\"token punctuation\">.</span>matchTemplate<span class=\"token punctuation\">(</span>screenshot_gray<span class=\"token punctuation\">,</span> template<span class=\"token punctuation\">,</span> cv2<span class=\"token punctuation\">.</span>TM_CCOEFF_NORMED<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    threshold <span class=\"token operator\">=</span> <span class=\"token number\">0.8</span>  <span class=\"token comment\"># 你可以调整这个阈值来找到最佳匹配</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    loc <span class=\"token operator\">=</span> np<span class=\"token punctuation\">.</span>where<span class=\"token punctuation\">(</span>res <span class=\"token operator\">>=</span> threshold<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\"># 获取匹配区域的左上角坐标</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">for</span> pt <span class=\"token keyword\">in</span> <span class=\"token builtin\">zip</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>loc<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        cv2<span class=\"token punctuation\">.</span>rectangle<span class=\"token punctuation\">(</span>screenshot_np<span class=\"token punctuation\">,</span> pt<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>pt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> w<span class=\"token punctuation\">,</span> pt<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> h<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\"># 显示结果图片</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># cv2.imshow('Detected', screenshot_np)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token comment\"># cv2.waitKey(0)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\"># cv2.destroyAllWindows()</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    button_center <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span>pt<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> w <span class=\"token operator\">//</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> pt<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">+</span> h <span class=\"token operator\">//</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f\"Button center: </span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>button_center<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">\"</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">return</span> button_center</pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\"># 通过图片定位对象位置</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>button_position <span class=\"token operator\">=</span> get_img_button_position<span class=\"token punctuation\">(</span><span class=\"token string\">'./data/kais.png'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>moveTo<span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>button_position<span class=\"token punctuation\">,</span> duration<span class=\"token operator\">=</span><span class=\"token number\">0.5</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 移动鼠标</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>pyautogui<span class=\"token punctuation\">.</span>click<span class=\"token punctuation\">(</span>clicks<span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span>  <span class=\"token comment\"># 左键点击</span></pre></td></tr></table></figure><h4 id=\"获取当前鼠标位置技巧\"><a class=\"anchor\" href=\"#获取当前鼠标位置技巧\">#</a> 获取当前鼠标位置技巧</h4>\n<p>运行以下代码，将光标固定在 input 输入后面，再将鼠标移动到目标点，回车，控制台就会输出目标的坐标</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> <span class=\"token builtin\">range</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token builtin\">input</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"当前坐标：\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>pyautogui<span class=\"token punctuation\">.</span>position<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "自动化",
                "PC自动化"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/04/JS%E9%80%86%E5%90%91/%E5%B8%B8%E7%94%A8hook/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/04/JS%E9%80%86%E5%90%91/%E5%B8%B8%E7%94%A8hook/",
            "title": "常用hook",
            "date_published": "2024-03-04T03:25:28.146Z",
            "content_html": "<h4 id=\"json-hook\"><a class=\"anchor\" href=\"#json-hook\">#</a> JSON HOOK</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> my_stringify <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>stringify<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">stringify</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">debugger</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_stringify params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> my_parse <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">parse</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 </span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">debugger</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_parse params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_parse</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"请求hook-当请求url里包含anlysis时插入断点\"><a class=\"anchor\" href=\"#请求hook-当请求url里包含anlysis时插入断点\">#</a> 请求 hook 当请求 url 里包含 anlysis 时，插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">var</span> open <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>open<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">open</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"analysis\"</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">!=</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">open</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"过debugger1-constructor-构造器构造出来的\"><a class=\"anchor\" href=\"#过debugger1-constructor-构造器构造出来的\">#</a> 过 debugger—1 constructor 构造器构造出来的</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> _constructor <span class=\"token operator\">=</span> constructor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">constructor</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_constructor</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"headers-hook-当header中包含authorization时则插入断点\"><a class=\"anchor\" href=\"#headers-hook-当header中包含authorization时则插入断点\">#</a> headers hook 当 header 中包含 Authorization 时，则插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">code</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> org <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>setRequestHeader<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">setRequestHeader</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">key<span class=\"token punctuation\">,</span>value</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>key<span class=\"token operator\">==</span><span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">org</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span>arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>script<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> code <span class=\"token operator\">+</span> <span class=\"token string\">')()'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>head<span class=\"token operator\">||</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>script<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"请求hook-当请求的url里包含mmewmd时则插入断点\"><a class=\"anchor\" href=\"#请求hook-当请求的url里包含mmewmd时则插入断点\">#</a> 请求 hook 当请求的 url 里包含 MmEwMD 时，则插入断点</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">code</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> open <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span>open<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">XMLHttpRequest</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">open</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">method<span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span><span class=\"token function\">indexOf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"MmEwMD\"</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">open</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> script <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>script<span class=\"token punctuation\">.</span>textContent <span class=\"token operator\">=</span> <span class=\"token string\">'('</span> <span class=\"token operator\">+</span> code <span class=\"token operator\">+</span> <span class=\"token string\">')()'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">.</span>head<span class=\"token operator\">||</span>document<span class=\"token punctuation\">.</span>documentElement<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">appendChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>script<span class=\"token punctuation\">.</span>parentNode<span class=\"token punctuation\">.</span><span class=\"token function\">removeChild</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"过debugger2-eval的\"><a class=\"anchor\" href=\"#过debugger2-eval的\">#</a> 过 debugger—2 eval 的</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">var</span> eval_ <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">eval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">x</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token function\">eval_</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"debugger;\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"  ; \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">.</span>toString <span class=\"token operator\">=</span> eval_<span class=\"token punctuation\">.</span>toString<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"对象属性hook-属性自定义hook-cookie操作\"><a class=\"anchor\" href=\"#对象属性hook-属性自定义hook-cookie操作\">#</a> 对象属性 hook 属性自定义，hook cookie 操作</h4>\n<p>这种操作只是针对通过 js 生成的 cookie，若 cookie 是服务器后台返回的则不起效果</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token comment\">// 严格模式，检查所有错误</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token string\">'use strict'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">//document 为要 hook 的对象，属性是 cookie</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>document<span class=\"token punctuation\">,</span><span class=\"token string\">'cookie'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token comment\">//hook set 方法也就是赋值的方法，get 就是获取的方法</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token function-variable function\">set</span><span class=\"token operator\">:</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">val</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token comment\">// 这样就可以快速给下面这个代码行下断点，从而快速定位设置 cookie 的代码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span>  <span class=\"token comment\">// 在此处自动断下</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Hook捕获到set-cookie ->'</span><span class=\"token punctuation\">,</span>val<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token keyword\">return</span> val<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"evalfunction\"><a class=\"anchor\" href=\"#evalfunction\">#</a> eval/Function</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>window<span class=\"token punctuation\">.</span>__cr_eval <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">myeval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">src</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">//src 就是 eval 运行后 最终返回的值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"========= eval end ===========\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span>__cr_eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> _myeval <span class=\"token operator\">=</span> <span class=\"token function\">myeval</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>_myeval<span class=\"token punctuation\">.</span>toString <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>__cr_eval<span class=\"token punctuation\">.</span>toString<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">'eval'</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> _myeval<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>window<span class=\"token punctuation\">.</span>_cr_fun <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>Function</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">var</span> <span class=\"token function-variable function\">myfun</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">var</span> args <span class=\"token operator\">=</span> <span class=\"token class-name\">Array</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function\">slice</span><span class=\"token punctuation\">.</span><span class=\"token function\">call</span><span class=\"token punctuation\">(</span>arguments<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">join</span><span class=\"token punctuation\">(</span><span class=\"token string\">\",\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> src <span class=\"token operator\">=</span> arguments<span class=\"token punctuation\">[</span>arguments<span class=\"token punctuation\">.</span>lenght <span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>src<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"======== Function end =============\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">_cr_fun</span><span class=\"token punctuation\">.</span><span class=\"token function\">apply</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> arguments<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>myfun<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token keyword\">return</span> window<span class=\"token punctuation\">.</span>_cr_fun <span class=\"token operator\">+</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">&#125;</span> <span class=\"token comment\">// 小花招，这里防止代码里检测原生函数</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"Function\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> myfun<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"eval-取返回值\"><a class=\"anchor\" href=\"#eval-取返回值\">#</a> eval 取返回值</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>_eval <span class=\"token operator\">=</span> eval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function-variable function\">eval</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">res</span><span class=\"token punctuation\">)</span><span class=\"token operator\">=></span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    res1 <span class=\"token operator\">=</span> res <span class=\"token comment\">// 返回值</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_eval</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">eval</span><span class=\"token punctuation\">(</span>xxxxxxxxx<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"websocket-hook\"><a class=\"anchor\" href=\"#websocket-hook\">#</a> websocket hook</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// 1、webcoket 一般都是 json 数据格式传输，那么发生之前需要 JSON.stringify  </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">var</span> my_stringify <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>stringify<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">stringify</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 debugger</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_stringify params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_stringify</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">var</span> my_parse <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span>parse<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function-variable function\">parse</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">params</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// 这里可以添加其他逻辑比如 debugger</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"json_parse params:\"</span><span class=\"token punctuation\">,</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">my_parse</span><span class=\"token punctuation\">(</span>params<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 2  webScoket 绑定在 windows 对象，上，根据浏览器的不同，websokcet 名字可能不一样 </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//chrome window.WebSocket  firfox window.MozWebSocket;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>window<span class=\"token punctuation\">.</span>_WebSocket <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>WebSocket<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// hook send</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>window<span class=\"token punctuation\">.</span><span class=\"token class-name\">_WebSocket</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">send</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">data</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">info</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Hook WebSocket\"</span><span class=\"token punctuation\">,</span> data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token function\">send</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Object<span class=\"token punctuation\">.</span><span class=\"token function\">defineProperty</span><span class=\"token punctuation\">(</span>window<span class=\"token punctuation\">,</span> <span class=\"token string\">\"WebSocket\"</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span><span class=\"token literal-property property\">value</span><span class=\"token operator\">:</span> WebSocket<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"hook-canvas-定位图片生成的地方\"><a class=\"anchor\" href=\"#hook-canvas-定位图片生成的地方\">#</a> hook canvas (定位图片生成的地方)</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token string\">'use strict'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">let</span> create_element <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">createElement</span><span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span>doument<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    document<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">createElement</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">_element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"create_element:\"</span><span class=\"token punctuation\">,</span>_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>_element <span class=\"token operator\">===</span> <span class=\"token string\">\"canvas\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token keyword\">debugger</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token function\">create_element</span><span class=\"token punctuation\">(</span>_element<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"setinterval-定时器\"><a class=\"anchor\" href=\"#setinterval-定时器\">#</a> setInterval 定时器</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">(</span><span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    setInterval_ <span class=\"token operator\">=</span> setInterval<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"原函数已被重命名为setInterval_\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token function-variable function\">setInterval</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    setInterval<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">toString</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"有函数正在检测setInterval是否被hook\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">return</span> setInterval_<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h4 id=\"setinterval-循环清除定时器\"><a class=\"anchor\" href=\"#setinterval-循环清除定时器\">#</a> setInterval 循环清除定时器</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">for</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">var</span> i <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">9999999</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span><span class=\"token punctuation\">)</span> window<span class=\"token punctuation\">.</span><span class=\"token function\">clearInterval</span><span class=\"token punctuation\">(</span>i<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"过药监局无限debugger\"><a class=\"anchor\" href=\"#过药监局无限debugger\">#</a> 过药监局无限 debugger</h4>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> _constructor <span class=\"token operator\">=</span> constructor<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token class-name\">Function</span><span class=\"token punctuation\">.</span>prototype<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">constructor</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_constructor</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// ---------------------------------------------</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">var</span> _Function <span class=\"token operator\">=</span> Function<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function-variable function\">Function</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">s</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">==</span> <span class=\"token string\">\"debugger\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">return</span> <span class=\"token function\">_Function</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "JS逆向",
                "hook"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/spider/Xpath%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/spider/Xpath%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95/",
            "title": "xpath 高级用法",
            "date_published": "2024-03-01T08:26:39.599Z",
            "content_html": "<h3 id=\"xpath-高级用法\"><a class=\"anchor\" href=\"#xpath-高级用法\">#</a> xpath 高级用法</h3>\n<h4 id=\"匹配当前节点下的所有\"><a class=\"anchor\" href=\"#匹配当前节点下的所有\">#</a> 匹配当前节点下的所有： .//</h4>\n<p>. 表示当前</p>\n<p>// 表示当前标签下的所有标签</p>\n<p>注： 要配合使用</p>\n<hr />\n<h4 id=\"匹配某标签的属性值-属性名称\"><a class=\"anchor\" href=\"#匹配某标签的属性值-属性名称\">#</a> 匹配某标签的属性值： /@属性名称</h4>\n<p>这里以 input 里的 value 值为例：</p>\n<p>例：xpath (//input/@value)</p>\n<hr />\n<h4 id=\"匹配多个路径\"><a class=\"anchor\" href=\"#匹配多个路径\">#</a> 匹配多个路径：|</h4>\n<p>在一个 xpath 中写的多个表达式用 | 分开， 每个表达式互不干扰。</p>\n<p>例：xpath (&quot;//tr [6]/td [2]/text () | //tr [7]/td [2]/text ()&quot;)</p>\n<hr />\n<h4 id=\"按属性匹配\"><a class=\"anchor\" href=\"#按属性匹配\">#</a> 按属性匹配：@</h4>\n<p>获取所有 id=&quot;test&quot; 的所有文本内容</p>\n<p>xpath('//*[@id=&quot;test&quot;]//text()')</p>\n<hr />\n<h4 id=\"匹配不包含某个属性的标签-not\"><a class=\"anchor\" href=\"#匹配不包含某个属性的标签-not\">#</a> 匹配不包含某个属性的标签 not</h4>\n<p>多用于表格中匹配中不包含表头信息的数据</p>\n<p>例：xpath ('//table/tr [not (@class=&quot;tbhead&quot;)]')</p>\n<hr />\n<h4 id=\"匹配包含多个属性的标签-and\"><a class=\"anchor\" href=\"#匹配包含多个属性的标签-and\">#</a> 匹配包含多个属性的标签: and</h4>\n<p>匹配所有的 tr 中不包含 tbhead 属性 和包含 head 的 tr 标签</p>\n<p>xpath('//table/tr[not(@class=&quot;tbhead&quot;) and @class=&quot;head&quot;]')</p>\n<hr />\n<h4 id=\"匹配包含不同属性的名称相同的标签-or\"><a class=\"anchor\" href=\"#匹配包含不同属性的名称相同的标签-or\">#</a> 匹配包含不同属性的名称相同的标签: or</h4>\n<p>匹配包含 class=&quot;speedbar&quot; 或者 class=&quot;content-wrap&quot; 的标签</p>\n<p>例：xpath（'//div [@class=&quot;speedbar&quot; or @class=&quot;content-wrap&quot;]'）</p>\n<hr />\n<h4 id=\"将对象还原为字符串etreetostring\"><a class=\"anchor\" href=\"#将对象还原为字符串etreetostring\">#</a> 将对象还原为字符串：etree.tostring（）</h4>\n<p>将匹配到的对象，作为 etree.tostring（）的参数即可， 注： 返回字符串</p>\n<p>sObj = xml.xpath ('//*[@id=&quot;test&quot;]')[0] #使用 xpath 定位一个节点</p>\n<p>sStr = etree.tostring(sObj)</p>\n<hr />\n<h4 id=\"按轴axes匹配\"><a class=\"anchor\" href=\"#按轴axes匹配\">#</a> 按轴 (Axes) 匹配</h4>\n<h5 id=\"选取当前节点的所有子元素-child\"><a class=\"anchor\" href=\"#选取当前节点的所有子元素-child\">#</a> 选取当前节点的所有子元素: child</h5>\n<p>获取 div 下的 tr 的标签</p>\n<p>例：xpath ('//div [@id=&quot;testid&quot;]/child::tr/td/text ()') # 感觉这种方法鸡肋， //div [@id=&quot;testid&quot;]//tr/td 也可以实现</p>\n<h5 id=\"选取当前节点的所有属性attribute\"><a class=\"anchor\" href=\"#选取当前节点的所有属性attribute\">#</a> 选取当前节点的所有属性：attribute</h5>\n<p>获取 div 标签所有的属性值</p>\n<p>例： xpath ('//div/attribute::<em>') # 感觉这种方法鸡肋，//div/@</em> 同样能实现</p>\n<h5 id=\"ancestor父辈元素-ancestor-or-self父辈元素及当前元素\"><a class=\"anchor\" href=\"#ancestor父辈元素-ancestor-or-self父辈元素及当前元素\">#</a> ancestor：父辈元素 /ancestor-or-self：父辈元素及当前元素</h5>\n<p>获取父辈元素的 div 的所有属性值， 在不好定位的情况下，通过孩子标签定位，这种方法可以用</p>\n<p>xpath('//div[@id=&quot;test&quot;]/ancestor::div/@*')</p>\n<p>xpath('//div[@id=&quot;test&quot;]/ancestor-or-self::div/@*')</p>\n<h5 id=\"descendant后代-descendant-or-self后代及当前节点本身\"><a class=\"anchor\" href=\"#descendant后代-descendant-or-self后代及当前节点本身\">#</a> descendant：后代 /descendant-or-self：后代及当前节点本身</h5>\n<p>获取孩子元素的 div 的所有属性值，感觉鸡肋</p>\n<p>xpath('//div[@id=&quot;test&quot;]/descendant::div/@*')</p>\n<p>xpath('//div[@id=&quot;test&quot;]/descendant-or-self::div/@*')</p>\n<h5 id=\"选取当前节点的所有命名空间节点namespace\"><a class=\"anchor\" href=\"#选取当前节点的所有命名空间节点namespace\">#</a> 选取当前节点的所有命名空间节点:namespace</h5>\n<p>xpath('//div[@id=&quot;test&quot;]/namespace:😗')</p>\n<h5 id=\"定位position\"><a class=\"anchor\" href=\"#定位position\">#</a> 定位:position</h5>\n<p>和通过下标定位一样， 方法鸡肋</p>\n<p>xpath('//*[@id=&quot;test&quot;]/ol/li[position()=2]/text()')</p>\n<hr />\n<h4 id=\"xpath-函数\"><a class=\"anchor\" href=\"#xpath-函数\">#</a> Xpath 函数：</h4>\n<h5 id=\"统计数量count\"><a class=\"anchor\" href=\"#统计数量count\">#</a> 统计数量：count</h5>\n<p>统计符合要求节点的数量， 注： 返回字符串</p>\n<p>xpath('count(//tr[@info])')</p>\n<h5 id=\"字符串拼接-concat\"><a class=\"anchor\" href=\"#字符串拼接-concat\">#</a> 字符串拼接 ：concat</h5>\n<p>统计出来的两个内容的字符串进行 “+” 处理， 注： 返回字符串</p>\n<p>xpath('concat(//li[@id=&quot;one&quot;]/text(),//li[@id=&quot;three&quot;]/text())')</p>\n<h5 id=\"解析当前节点下的字符string\"><a class=\"anchor\" href=\"#解析当前节点下的字符string\">#</a> 解析当前节点下的字符：string</h5>\n<p>string () 直解析匹配的第一个标签的值， 注： 返回字符串</p>\n<p>xpath('string(//tr)')</p>\n<p>element.xpath ('string (.)') #获取 element 下的所有文本</p>\n<h5 id=\"获取当前节点的节点名称-local-name\"><a class=\"anchor\" href=\"#获取当前节点的节点名称-local-name\">#</a> 获取当前节点的节点名称: local-name</h5>\n<p>返回当前属性的节点名称， 注： 返回字符串</p>\n<p>xpath('local-name(//*[@id=&quot;test&quot;])')</p>\n<h5 id=\"以指定的字符开头starts-with\"><a class=\"anchor\" href=\"#以指定的字符开头starts-with\">#</a> 以指定的字符开头：starts-with</h5>\n<p>starts-with 定位属性值以 8 开头的 li 元素</p>\n<p>xpath('//tr[starts-with(@code,&quot;one&quot;)]/text()')</p>\n<h5 id=\"小于\"><a class=\"anchor\" href=\"#小于\">#</a> 小于：&lt;</h5>\n<p>匹配所有 tr 标签属性 info 小于 200 的内容</p>\n<p>xpath('//tr[@info&lt;200]/text()')</p>\n<h5 id=\"查看元素是否存在boolean\"><a class=\"anchor\" href=\"#查看元素是否存在boolean\">#</a> 查看元素是否存在：boolean</h5>\n<p>boolean(./td[1]/img)</p>\n<hr />\n<h5 id=\"根据指定的文本内容选择\"><a class=\"anchor\" href=\"#根据指定的文本内容选择\">#</a> 根据指定的文本内容选择</h5>\n<h5 id=\"相对定位指定的文本内容可以是文本内容的部分-也可以是全部\"><a class=\"anchor\" href=\"#相对定位指定的文本内容可以是文本内容的部分-也可以是全部\">#</a> 相对定位，指定的文本内容可以是文本内容的部分， 也可以是全部</h5>\n<p>//div [2]/ul/li [contains (text (), &quot;指定的文本内容&quot;)]/span/text ()</p>\n<h5 id=\"精准定位目标文本和搜索文本完全一致\"><a class=\"anchor\" href=\"#精准定位目标文本和搜索文本完全一致\">#</a> 精准定位，目标文本和搜索文本完全一致</h5>\n<p>//div [2]/ul/li [text ()=&quot;指定的文本内容&quot;]/span/text ()</p>\n<hr />\n<h4 id=\"通过文本内容定位兄弟标签的文本内容\"><a class=\"anchor\" href=\"#通过文本内容定位兄弟标签的文本内容\">#</a> 通过文本内容定位兄弟标签的文本内容</h4>\n<p>//span [@class='tbtitem' and text ()=' 使用语言：']/following-sibling::text ()</p>\n<figure class=\"highlight html\"><figcaption data-lang=\"HTML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>// 定位【英语】</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tbtitem ys<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    页数：</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>3\\r\\n <span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span><span class=\"token entity named-entity\" title=\"&nbsp;\">&amp;nbsp;</span>\\r\\n</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>span</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>tbtitem<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    使用语言：</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>span</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>英语 \\r\\n\\t\\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>br</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p><em>注： 以上内容， 除标注外， 均返回列表！！</em></p>\n<hr />\n<h4 id=\"position定位\"><a class=\"anchor\" href=\"#position定位\">#</a> position：定位</h4>\n<p>选择偶数项：td [position ()=(position () mod 2 = 0)]</p>\n<p>选择奇数项：td [position ()=(position () mod 2 != 0)]</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>driver<span class=\"token punctuation\">.</span>find_elements_by_xpath<span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'//td[contains(text(),\"核注清单\")]/ancestor::tr/td[position()=(position() mod 2 != 0)]'</span></span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><hr />\n<h4 id=\"查看元素的网页源码\"><a class=\"anchor\" href=\"#查看元素的网页源码\">#</a> 查看元素的网页源码</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>a <span class=\"token operator\">=</span> html2<span class=\"token punctuation\">.</span>xpath<span class=\"token punctuation\">(</span><span class=\"token string\">'//table[@class=\"zebra\"]'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>etree<span class=\"token punctuation\">.</span>tostring<span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> encoding<span class=\"token operator\">=</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure>",
            "tags": [
                "spider",
                "xpath"
            ]
        },
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/python/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/python/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "title": "定时任务",
            "date_published": "2024-03-01T03:01:23.053Z",
            "content_html": "<h4 id=\"schedule\"><a class=\"anchor\" href=\"#schedule\">#</a> schedule</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> schedule</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># 这里是你要执行的任务代码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行任务\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 设定每天的特定时间，例如每天 23:59:59</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>schedule<span class=\"token punctuation\">.</span>every<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>day<span class=\"token punctuation\">.</span>at<span class=\"token punctuation\">(</span><span class=\"token string\">\"23:59:59\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>do<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 每小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":00\").do(job)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 每小时的 30 分钟，执行一次</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":30\").do(job)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 循环调度任务</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    schedule<span class=\"token punctuation\">.</span>run_pending<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"blockingscheduler推荐\"><a class=\"anchor\" href=\"#blockingscheduler推荐\">#</a> BlockingScheduler（推荐）</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> apscheduler<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>blocking <span class=\"token keyword\">import</span> BlockingScheduler</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>shanghai <span class=\"token operator\">=</span> <span class=\"token string\">'Asia/Shanghai'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 创建调度器</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>scheduler <span class=\"token operator\">=</span> BlockingScheduler<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>timezone<span class=\"token operator\">=</span>shanghai<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每 2 小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> hours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每月 1 号凌晨 0 点执行</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'cron'</span><span class=\"token punctuation\">,</span> month<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> day<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> hour<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> minute<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> second<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 启动调度器</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"参数说明\"><a class=\"anchor\" href=\"#参数说明\">#</a> 参数说明</h5>\n<ul>\n<li>\n<p>weeks (int) – 隔多少周执行一次任务</p>\n</li>\n<li>\n<p>days (int) – 隔多少天执行一次任务</p>\n</li>\n<li>\n<p>hours (int) – 隔多少个小时执行一次任务</p>\n</li>\n<li>\n<p>minutes (int) – 隔几分钟执行一次任务</p>\n</li>\n<li>\n<p>seconds (int) – 隔几秒执行一次任务</p>\n</li>\n<li>\n<p>start_date - 指定开始时间 (datetime|str) – starting point for the interval calculation</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>end_date - 指定结束时间</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>timezone - 时区，中国就用 'Asia/Shanghai' 就行</p>\n</li>\n<li>\n<p>jitter 时间偏移量，单位秒</p>\n<ul>\n<li>\n<p>在预定运行时间的基础上，加上一个随机的秒数</p>\n<p>例如 预定运行时间为 10:20:20 偏移量为 10 则真实运行时间期间为 [10:20:20-10:20:30]</p>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"形参说明\"><a class=\"anchor\" href=\"#形参说明\">#</a> 形参说明</h5>\n<p>如果要执行的任务需要参数，可以通过 scheduler.add_job (args=(a,b)) 进行添加</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> arghours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure>",
            "tags": [
                "python",
                "定时任务"
            ]
        }
    ]
}