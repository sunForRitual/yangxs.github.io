{
    "version": "https://jsonfeed.org/version/1",
    "title": "yangxs",
    "subtitle": "",
    "icon": "https://sunforritual.github.io/yangxs.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://sunforritual.github.io/yangxs.github.io",
    "items": [
        {
            "id": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "url": "https://sunforritual.github.io/yangxs.github.io/2024/03/01/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/",
            "title": "定时任务",
            "date_published": "2024-03-01T03:01:23.053Z",
            "content_html": "<h4 id=\"1-schedule\"><a class=\"anchor\" href=\"#1-schedule\">#</a> 1 schedule</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> schedule</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">import</span> time</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># 这里是你要执行的任务代码</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"执行任务\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 设定每天的特定时间，例如每天 23:59:59</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>schedule<span class=\"token punctuation\">.</span>every<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>day<span class=\"token punctuation\">.</span>at<span class=\"token punctuation\">(</span><span class=\"token string\">\"23:59:59\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>do<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 每小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":00\").do(job)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span><span class=\"token operator\">-</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 每小时的 30 分钟，执行一次</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># schedule.every().hour.at(\":30\").do(job)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 循环调度任务</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">while</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    schedule<span class=\"token punctuation\">.</span>run_pending<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    time<span class=\"token punctuation\">.</span>sleep<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h4 id=\"2-blockingscheduler推荐\"><a class=\"anchor\" href=\"#2-blockingscheduler推荐\">#</a> 2 BlockingScheduler（推荐）</h4>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">from</span> apscheduler<span class=\"token punctuation\">.</span>schedulers<span class=\"token punctuation\">.</span>blocking <span class=\"token keyword\">import</span> BlockingScheduler</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>shanghai <span class=\"token operator\">=</span> <span class=\"token string\">'Asia/Shanghai'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 创建调度器</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>scheduler <span class=\"token operator\">=</span> BlockingScheduler<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>configure<span class=\"token punctuation\">(</span>timezone<span class=\"token operator\">=</span>shanghai<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每 2 小时执行一次</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> hours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 添加定时任务，每月 1 号凌晨 0 点执行</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'cron'</span><span class=\"token punctuation\">,</span> month<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> day<span class=\"token operator\">=</span><span class=\"token string\">'1'</span><span class=\"token punctuation\">,</span> hour<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> minute<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">,</span> second<span class=\"token operator\">=</span><span class=\"token string\">'0'</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 启动调度器</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>start<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h5 id=\"参数说明\"><a class=\"anchor\" href=\"#参数说明\">#</a> 参数说明</h5>\n<ul>\n<li>\n<p>weeks (int) – 隔多少周执行一次任务</p>\n</li>\n<li>\n<p>days (int) – 隔多少天执行一次任务</p>\n</li>\n<li>\n<p>hours (int) – 隔多少个小时执行一次任务</p>\n</li>\n<li>\n<p>minutes (int) – 隔几分钟执行一次任务</p>\n</li>\n<li>\n<p>seconds (int) – 隔几秒执行一次任务</p>\n</li>\n<li>\n<p>start_date - 指定开始时间 (datetime|str) – starting point for the interval calculation</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>end_date - 指定结束时间</p>\n<ul>\n<li>可以是 datetime 对象、date 对象、&quot;% Y-% m-% d % H:% M:% S&quot; 的字符串</li>\n</ul>\n</li>\n<li>\n<p>timezone - 时区，中国就用 'Asia/Shanghai' 就行</p>\n</li>\n<li>\n<p>jitter 时间偏移量，单位秒</p>\n<ul>\n<li>\n<p>在预定运行时间的基础上，加上一个随机的秒数</p>\n<p>例如 预定运行时间为 10:20:20 偏移量为 10 则真实运行时间期间为 [10:20:20-10:20:30]</p>\n</li>\n</ul>\n</li>\n</ul>\n<h5 id=\"形参说明\"><a class=\"anchor\" href=\"#形参说明\">#</a> 形参说明</h5>\n<p>如果要执行的任务需要参数，可以通过 scheduler.add_job (args=(a,b)) 进行添加</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">job</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"定时任务执行了！\"</span><span class=\"token punctuation\">,</span> a<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>scheduler<span class=\"token punctuation\">.</span>add_job<span class=\"token punctuation\">(</span>job<span class=\"token punctuation\">,</span> <span class=\"token string\">'interval'</span><span class=\"token punctuation\">,</span> arghours<span class=\"token operator\">=</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span></pre></td></tr></table></figure>",
            "tags": [
                "python"
            ]
        }
    ]
}